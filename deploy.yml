- name: Playbook de Atualizações de Sistemas Operacionais e implementação do zabbix 3 Camadas.
  hosts:
    - zabbix
  
  vars:
    # VARIAVEL DE HOSTS
    - zbx_front: 172.18.10.100
    - zbx_srv: 172.18.10.110 
    - zbx_db: 172.18.10.120

    # VARIAVEL CRIAÇÃO DO BANCO DE DADOS 
    - db_name: 'zabbix'
    
    # VARIAVEL CRIAÇÃDO DO USUARIO ZABBIX LOCALHOST
    - db_user_zabbix: 'zabbix'
    - db_user_zabbix_pass: 'zabbix'
    
    # VARIAVEL CRIAÇÃO DO USUARIO ZABBIX SERVER
    - db_user_server: 'zabbix_server'
    - db_user_pass_server: 'zabbix'
    
    # VARIAVEIS DE CRIAÇÃO DE USUARIO zabbix_web 
    - db_user_web: 'zabbix_web'
    - db_user_pass_web: 'zabbix'
    - zbx_port: 10051
    - zbx_name: Monitor_Ansible
    - zbx_web: 'zabbix'
 
    # VARIAVEL DE PORTAS FRONT END
      port_firewall_front:
        - 10051/tcp
        - 10050/tcp
        - 3306/tcp
        - 80/tcp
        - 443/tcp
        
    # VARIAVEL DE TimeZone.
    - timezone: America/Sao_Paulo
    
    # VARIAVEL DE URL_ZABBIX
    - url_packages_zabbix: http://repo.zabbix.com/zabbix/5.5/rhel/8/x86_64/zabbix-release-5.5-1.el8.noarch.rpm 
    
   # LISTA DE PACOTES INSTALAR FRONTEND
    - packages_zabbix_frontend:
        - mysql 
        - zabbix-apache-conf
        - zabbix-web-mysql
        - httpd


  roles:
    - role: Common
    - role: db_zabbix
      when: ansible_host == zbx_db
    - role: zabbix_server
      when: ansible_host == zbx_srv
    - role: zabbix_front
      when: ansible_host == zbx_front
    - role: zabbix_agent_linux
      when: ansible == zbx_front or zbx_db
    
