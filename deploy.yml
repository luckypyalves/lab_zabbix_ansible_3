- name: Playbook de Instalação e Implementação Zabbix 3 Camadas Usando CentOS + Vagrant
  hosts:
    - zabbix
      # - DC01
  
  vars:
    
    # VARIAVEL DE HOSTS
    
    - zbx_front: 172.18.10.100
    - zbx_srv: 172.18.10.110
    - zbx_db: 172.18.10.120
    - DC01: 192.168.3.200
    
    # VARIAVEL DE TimeZone.
    - timezone: America/Sao_Paulo
    
    # Schema Criação banco de Dados MYSQL8.0
    - url_schema: zcat /usr/share/doc/zabbix-sql-scripts/mysql/create.sql.gz | mysql -h 172.18.10.120 -u zabbix_server -pzabbix zabbix
    - url_partition: "mysql -h 192.168.3.120 -u zabbix_server -pzabbix zabbix < /opt/zbx_db_part.sql"


    # VARIAVEL DE API URL  
    - url_zabbix: http://172.18.10.100/zabbix/
    
    # VARIAVEL DE URL_ZABBIX
    - url_packages_zabbix: http://repo.zabbix.com/zabbix/5.5/rhel/8/x86_64/zabbix-release-5.5-1.el8.noarch.rpm 
      
    # VARIAVEIS DE URL GRAFANA
    - url_packages_grafana: https://dl.grafana.com/oss/release/grafana-8.2.5-1.x86_64.rpm
    

    # SENHA DO ROOT
    - root_pass: 'zabbix'

    # VARIAVEL CRIAÇÃO DO BANCO DE DADOS 
    - db_name: 'zabbix'
    
    # VARIAVEL CRIAÇÃDO DO USUARIO ZABBIX LOCALHOST
    - db_user_zabbix: 'zabbix'
    - db_user_zabbix_pass: 'zabbix'
    
    # VARIAVEL CRIAÇÃO DO USUARIO ZABBIX SERVER
    - db_user_server: 'zabbix_server'
    - db_user_pass_server: 'zabbix'
    
    # VARIAVEIS DE CRIAÇÃO DE USUARIO zabbix_web 
    - db_user_web: 'zabbix_web'
    - db_user_pass_web: 'zabbix'

    # CONFIGURAÇÃO DO FRONTEND DO ZABBIX
    - zbx_port: 10051
    - zbx_name: Monitor_Ansible
    - zbx_web: 'zabbix'
 
    # VARIAVEL DE PORTAS FRONT END
      port_firewall_front:
        - 10051/tcp
        - 10050/tcp
        - 3306/tcp
        - 80/tcp
        - 443/tcp

    
    # LISTA DE PACOTES INSTALAR FRONTEND
    - packages_zabbix_frontend:
        - mysql
        - zabbix-agent2 
        - zabbix-apache-conf
        - zabbix-web-mysql
        - httpd
  
  roles:
   
    - role: Common_Linux
    - role: db_zabbix
      when: ansible_host == zbx_db
    - role: zabbix_server
      when: ansible_host == zbx_srv
    - role: zabbix_front
      when: ansible_host == zbx_front
    - role: zabbix_agent_linux
      when: ansible_host == zbx_front
    - role: zabbix_agent_linux
      when: ansible_host == zbx_db
    - role: api_add_linux
    # INCIANDO ROLES DO WINDOWS 
    #- role: Common_Windows
    #- role: api_add_windows
